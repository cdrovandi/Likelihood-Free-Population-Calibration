
%% estimation with 5 unknown parameters

load('data.mat')

% define prior
prior.num_params = 10;

prior.p1 = [2.5e5 0.25 2 0.005 0.1 0 0 0 0 0];
prior.p2 = [8e5 3 20 0.1 0.5 200 2 2 2 2];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta_trans) prod(exp(theta_trans)./(1 + exp(theta_trans)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta_trans) [(prior.p2.*exp(theta_trans) + prior.p1)./(1 + exp(theta_trans))];


sim_func = @growth_sim;
sim_params.m = 100;



M = 50000; % number of MCMC iterations
m = 36; % number of model simulations for estimating synthetic likelihood

start = prior.trans_f([6.5e5 1.7 8 0.015 0.25 77.4597 0.2236 0.0001 0.0001 0.0001]);

% obtained from some pilot runs
cov_rw = 0.05*[0.323039387963315,-0.176754658495510,-0.313957726351352,-0.228663605076316,-0.322494935561287,-0.875345025287805,-0.0221518566416928,-1.23534917908718,-0.186429571599374,-0.280479383249091;-0.176754658495510,0.475105868600202,0.381306021145393,0.0884125609663408,0.0702543630287873,0.735995541420966,0.132257951004153,0.575297754598167,0.0572258456068241,0.129894278646875;-0.313957726351352,0.381306021145393,0.529353672184546,0.281587146279870,0.438563452088242,1.28265792363308,0.0787015437332430,1.45318046723462,0.288716535860218,0.370052712847269;-0.228663605076316,0.0884125609663408,0.281587146279870,0.227278572293617,0.381683220758844,0.821938161848509,-0.00371532619528774,1.11670297587094,0.233218416067405,0.283026412043023;-0.322494935561287,0.0702543630287873,0.438563452088242,0.381683220758844,0.684195661756312,1.31474254501826,-0.0287122553286665,1.78132951458851,0.425017887576252,0.482129989925189;-0.875345025287805,0.735995541420966,1.28265792363308,0.821938161848509,1.31474254501826,4.45558822836844,0.102121503187836,5.45034850074894,0.482200891890215,1.31281818461497;-0.0221518566416928,0.132257951004153,0.0787015437332430,-0.00371532619528774,-0.0287122553286665,0.102121503187836,0.0491499474373673,-0.00591878016235122,-0.0170177119078394,0.0131225284481496;-1.23534917908718,0.575297754598167,1.45318046723462,1.11670297587094,1.78132951458851,5.45034850074894,-0.00591878016235122,8.16051127339998,0.574461066773281,1.87105199566141;-0.186429571599374,0.0572258456068241,0.288716535860218,0.233218416067405,0.425017887576252,0.482200891890215,-0.0170177119078394,0.574461066773281,0.673054649614535,0.135681939057355;-0.280479383249091,0.129894278646875,0.370052712847269,0.283026412043023,0.482129989925189,1.31281818461497,0.0131225284481496,1.87105199566141,0.135681939057355,1.20868019503374];

[theta, loglike] = bayes_bsl(y,m,M,start,cov_rw,prior,sim_func,sim_params);

save('results_bsl_growth.mat');




%% estimation with 2 unknown parameters


load('data.mat')

% define prior
prior.num_params = 4;

prior.p1 = [2.5e5 0.25 0 0];
prior.p2 = [8e5 3 200 2];
prior.sampler = @() [unifrnd(prior.p1,prior.p2)]; 
prior.pdf = @(theta_trans) prod(exp(theta_trans)./(1 + exp(theta_trans)).^2);
prior.trans_f = @(theta) [log((theta - prior.p1)./(prior.p2 - theta))];
prior.trans_finv = @(theta_trans) [(prior.p2.*exp(theta_trans) + prior.p1)./(1 + exp(theta_trans))];


sim_func = @growth_sim_subset;
sim_params.m = 100;



M = 20000; % number of MCMC iterations
m = 24;  % number of model simulations for estimating synthetic likelihood

start = prior.trans_f([6.5e5 1.7 77.4597 0.2236]);

% obtained from some pilot runs
cov_rw = [0.000465456440680725,-0.000847519493918080,0.00119684531727806,-0.000531415778717901;-0.000847519493918080,0.00210199588290166,0.000908584131425829,0.000908661364747227;0.00119684531727806,0.000908584131425829,3.80890287009560,-0.00389346373629388;-0.000531415778717901,0.000908661364747227,-0.00389346373629388,0.00520428536152752];

[theta, loglike] = bayes_bsl(y,m,M,start,cov_rw,prior,sim_func,sim_params);

save('results_bsl_growth_subset.mat','theta','loglike');


